@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <title>@ViewData["Title"]</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link href="~/css/site.css" rel="stylesheet" />
    <style>
        body.light-theme {
            background-color: #f8f9fa;
            color: #212529;
        }

        body.dark-theme {
            background-color: #212529;
            color: #f8f9fa;
        }

        .navbar {
            transition: 0.3s;
        }

            .navbar .btn {
                transition: 0.3s;
            }

        body.light-theme .navbar {
            background-color: #ffffff !important;
            color: #212529 !important;
        }

        body.dark-theme .navbar {
            background-color: #343a40 !important;
            color: #f8f9fa !important;
        }

        body.light-theme .navbar .btn {
            background-color: #e2e6ea !important;
            color: #212529 !important;
        }

        body.dark-theme .navbar .btn {
            background-color: #495057 !important;
            color: #f8f9fa !important;
        }

        body.light-theme .card, body.light-theme table {
            background-color: #ffffff;
            color: #212529;
        }

        body.dark-theme .card, body.dark-theme table {
            background-color: #343a40;
            color: #f8f9fa;
        }

        body.dark-theme .btn-outline-primary {
            color: #0dcaf0;
            border-color: #0dcaf0;
        }

        body.dark-theme .btn-outline-primary:hover {
             background-color: #0dcaf0;
             color: #212529;
        }

        body.light-theme .navbar .navbar-brand {
            color: #212529 !important;
        }

        body.dark-theme .navbar .navbar-brand {
            color: #f8f9fa !important;
        }
    </style>
</head>
<body class="@((HttpContextAccessor.HttpContext.Request.Cookies["theme"] ?? "light-theme"))">

    <nav class="navbar navbar-expand-lg mb-4">
        <div class="container d-flex justify-content-between align-items-center">
            <span class="navbar-brand">Система регистрации пропусков</span>

            <a href="https://t.me/godovih87"
               target="_blank"
               class="btn btn-outline-primary d-flex align-items-center gap-2"
               title="Связаться с администратором">
                <i class="bi bi-telegram"></i>
                <span class="d-none d-md-inline">Администратор - поддержка</span>
            </a>
        </div>
    </nav>


    <div class="container">
        @RenderBody()
    </div>

    <!-- Кнопка темы -->
    <div id="floatingButtons" style="
        position: fixed;
        top: 10px;
        right: 10px;
        z-index: 9999;
    ">
        <button class="btn btn-secondary btn-sm" id="btnTheme">Тема</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const themeButton = document.getElementById('btnTheme');

        // Инициализация темы из cookie
        let currentTheme = getCookie('theme') || 'light-theme';
        document.body.classList.remove('light-theme', 'dark-theme');
        document.body.classList.add(currentTheme);
        updateThemeButton();

        // Переключение темы
        themeButton.onclick = () => {
            currentTheme = currentTheme === 'light-theme' ? 'dark-theme' : 'light-theme';
            document.body.classList.remove('light-theme', 'dark-theme');
            document.body.classList.add(currentTheme);
            setCookie('theme', currentTheme, 365);
            updateThemeButton();
        };

        function updateThemeButton() {
            if (currentTheme === 'light-theme') {
                themeButton.classList.remove('btn-dark');
                themeButton.classList.add('btn-secondary');
                themeButton.textContent = 'Тема: Светлая';
            } else {
                themeButton.classList.remove('btn-secondary');
                themeButton.classList.add('btn-dark');
                themeButton.textContent = 'Тема: Тёмная';
            }
        }

        function setCookie(name, value, days) {
            const d = new Date();
            d.setTime(d.getTime() + (days*24*60*60*1000));
            document.cookie = name + "=" + value + ";path=/;expires=" + d.toUTCString();
        }

        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null;
        }
    </script>

    @RenderSection("Scripts", required: false)
</body>
</html>
